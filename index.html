<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Чертов сайт</title>
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link id="faviconLink" rel="icon" type="image/x-icon" href="favicon.ico?v=4">
    <script src="https://widget.cloudpayments.ru/bundles/cloudpayments.js"></script>
  </head>
  <body>
    <form id="paymentFormSample" autocomplete="off" accept-charset="utf-8">
     Введите почту:
     <input type="text" id="email" value='example@gmail.com'> <br/>
     Введите номер телефона:
     <input type="text" id="phone" value='89991234567'> <br/>
     Введите Фамилию:
     <input type="text" id="surname" value='Иванов'> <br/>
     Введите Имя:
     <input type="text" id="name" value='Иван'> <br/>
     Введите Отчество:
     <input type="text" id="lastname" value='Иванович'> <br/>
     Введите комментарии:
     <input type="text" id="decript" value='На Геншин'> <br/>
    </form>
    <button onclick="pay()" id="submitButton" type="submit">Оплатить 10 р.</button> <br/>
      <input id="subsCheckbox" type="checkbox">
      <label>Сделать платеж ежемесячным</label>
      <script defer src="main.js"></script>
      <script>
    // async function Submit()
    //     {
    //       let escrow = {
    //         StartAccumulation: true,
    //         EscrowType: 0
    //       }

    //       const myHeaders = new Headers();
    //       const basic = btoa('pk_aff17de359b486f45c12b4e4fdab0:161e5df19cdff1a23a01f76be4346ce9')
    //       myHeaders.append("Content-Type", "application/json");
    //       myHeaders.append("Access-Control-Allow-Headers", "Authorization");
    //       myHeaders.append("Authorization", "Basic " + basic);
          
    //       let test = await fetch("https://cors-anywhere.herokuapp.com/https://api.cloudpayments.ru/payments/list")
    //       console.log("все: "  + JSON.stringify(await test.json()))

    //       let response = await fetch("https://cors-anywhere.herokuapp.com/https://api.cloudpayments.ru/payments/cards/auth", {
    //             method: "POST",
    //             body: JSON.stringify({
    //               Amount: 10,
    //               IpAddress: "192.192.192.192",
    //               CardCryptogramPacket: crypto,
    //               AccountId: "user_x",
    //               escrow: escrow,
    //               SaveCard: true
    //             }),
    //             headers: myHeaders
    //           });

    //       if (!response.ok)
    //       {
    //         console.log("Ошибка")
    //         console.log(response)
    //       }

    //       let resData = await response.json()
    //       console.log(resData)
    //       let trId = resData["Model"]["TransactionId"]

    //       let response1 = await fetch("https://cors-anywhere.herokuapp.com/https://api.cloudpayments.ru/payments/charge", {
    //             method: "POST",
    //             body: JSON.stringify({
    //               TransactionId: trId,
    //               Amount: 10
    //             }),
    //             headers: myHeaders
    //           });
    //           console.log("подтверждение: "  + JSON.stringify(await response1.json()))

    //       if (document.getElementById("subsCheckbox").checked)
    //       {

    //         const token = resData["Model"]["Token"]
    //         console.log("Токен: " + token)
    //         const date = addMinutes(new Date(Date.now()), 30)  // через 30 мин
    //         console.log("Дата: " + date.toISOString().slice(0, 19))
        
    //         response = await fetch("https://cors-anywhere.herokuapp.com/https://api.cloudpayments.ru/payments/subscriptions/create", {
    //             method: "POST",
    //             headers: myHeaders,
    //             body: JSON.stringify({
    //               Token: token,
    //               Amount: 10,
    //               Description: "Донат в Геншин",
    //               AccountId: "user_x",
    //               Currency: "RUB",
    //               Payer: {
    //                 Phone: "89991234567"
    //               },
    //               RequireConfirmation: true,
    //               StartDate:  date.toISOString().slice(0, 19),
    //               Interval: "Month",
    //               Period: 1
                  
    //             })
    //           });

    //           if (!response.ok)
    //           {
    //             console.log("Ошибка")
    //             console.log(response)
    //           }

    //           resData = await response.json()
    //           console.log(resData)

    //       }

        
    //   }
    


        // let containerData = document.getElementById("paymentFormSample")

        // const checkout = new cp.Checkout({
        //   publicId: 'pk_aff17de359b486f45c12b4e4fdab0',
        //   APISecret: '161e5df19cdff1a23a01f76be4346ce9',
        //   container: document.getElementById("paymentFormSample")
        // });

        // checkout.createPaymentCryptogram()
        //     .then((cryptogram) => {
        //       console.log("Крипто готова")
        //       crypto = cryptogram
        //     }).catch((errors) => {
        //       console.log("Крипто не готова")
        //   });


    </script>
  </body>
</html>
<!--<style>
 p {
  color: red;
 }
 .text {
  font-size: 24px;
 }
</style>->
